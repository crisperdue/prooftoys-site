#!/bin/bash
#
# Deploy prooftoys-site from the ~/src/publish area.

PUB=~/src/publish
TREE=~/tmp/prooftoys-site-tree

run() {
  echo '$' $@
  eval "$@"
}

make_tree() {
  rm -rf "$2"
  rsync -rt -l --copy-unsafe-links --delete-after \
    --exclude=.git --exclude=.DS_Store --exclude=webalizer \
    "$1/" "$2"
}

PROOFTOYS=~/src/publish/prooftoys
run cd $PROOFTOYS
echo ==== PROOFTOYS ====
run git pull

PSITE=~/src/publish/prooftoys-site
run cd $PSITE
echo ==== PSITE ====
run git pull

run ./hugo
# run git pull
# run ln -s ~/src/psite/themes .
# run ./hugo
# run make_tree public/ $TREE
# run cd $TREE
run netlify deploy --site prooftoys.netlify.app --dir public -p
